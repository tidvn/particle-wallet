"use client";
import{a as U}from"./chunk-6Y72V72Q.js";import{a as j}from"./chunk-GVI7HDAH.js";import"./chunk-IKGID5DT.js";import"./chunk-WN72JIRK.js";import{a as O}from"./chunk-4SMRMVPX.js";import{b as T}from"./chunk-QNAXMJIS.js";import{a as q}from"./chunk-AMOVWUCP.js";import{g as I}from"./chunk-PZJW4BGW.js";import"./chunk-O6HTNRMG.js";import{H as D,I as F,J as G,K as H,w as z,x as V}from"./chunk-ZHONLBSB.js";import"./chunk-L535NPP3.js";import{ApiError as m,AuthType as g,bindLoginAccount as he,getBindSecurityAccounCaptcha as ve,getCloudflareTurnstileResponse as xe,getSecurityAccountCaptcha as be,getSecurityAccountToken as Ce,setPaymentPassword as _e,syncUserInfo as J,thirdpartyAuth as we}from"@particle-network/auth-core";import{useInterval as Ae,useRequest as h}from"ahooks";import{Button as K,Modal as ke}from"antd";import Te from"base64url";import Le from"lodash/throttle.js";import o,{useCallback as Ne,useEffect as Q,useMemo as Se,useRef as Be,useState as b}from"react";import{useTranslation as Ee}from"react-i18next";var $=`.set-viery-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  overflow: auto;
  color: var(--text-color);
}
.set-viery-container .footer-box {
  position: absolute;
  bottom: 10px;
  margin: 0;
}
@media only screen and (max-height: 520px) {
  .set-viery-container .footer-box {
    position: unset;
    bottom: 0;
    margin-top: 20px;
    margin-bottom: 10px;
  }
}
.set-viery-container .display-none {
  display: none;
}
.set-viery-container .error-tip {
  width: 90%;
  height: 0;
  padding-left: 10px;
  margin-top: 6px;
  margin-bottom: 0;
  text-align: left;
  color: red;
  opacity: 0;
  transition: all 0.3s;
}
.set-viery-container .error-tip.show {
  height: 30px;
  opacity: 1;
}
.set-viery-container .set-email-title {
  margin-top: 60px;
  font-size: 22px;
  color: var(--text-color);
}
.set-viery-container .patment-tips1 {
  width: 80vw;
  margin-top: 30px;
  font-size: 14px;
  text-align: center;
  color: var(--text-color);
}
@media (min-width: 600px) {
  .set-viery-container .patment-tips1 {
    width: calc(80 * var(--vw));
  }
}
.set-viery-container .set-email-buttons {
  position: absolute;
  bottom: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  width: 100%;
  height: auto;
  padding-bottom: 20px;
}
.set-viery-container .success-icon {
  width: 50px;
  height: 50px;
  margin-top: 60px;
}
.set-viery-container .set-email-desc-1 {
  box-sizing: border-box;
  padding: 0 18px;
  margin: 15px 0 25px;
  font-weight: 400;
  font-size: 14px;
  line-height: 16px;
  text-align: center;
  color: var(--text-color);
}
.set-viery-container .account-submit-btn {
  width: 90%;
  height: 47px;
  padding: 0;
  margin-top: 38px;
  border: none;
  border-radius: var(--primary-btn-border-radius);
  font-weight: 500;
  font-size: var(--primary-btn-font-size);
  line-height: 47px;
  text-align: center;
  color: var(--primary-btn-color);
  background: var(--primary-btn-background-color);
  opacity: 1;
}
.set-viery-container .account-submit-btn:hover {
  border: none;
  color: var(--primary-btn-color) !important;
  background: var(--primary-btn-background-color) !important;
  opacity: var(--hover-opacity);
}
.set-viery-container .account-switch-item {
  margin-top: 40px;
  font-weight: 500;
  font-size: 13px;
  line-height: 19px;
  color: var(--accent-color);
  cursor: pointer;
}
.set-viery-container .set-email-desc-2 {
  min-width: 116px;
  height: 23px;
  padding: 0 15px;
  margin: 20px 0 28px;
  border-radius: var(--primary-btn-border-radius);
  font-weight: 400;
  font-size: 12px;
  line-height: 23px;
  text-align: center;
  color: var(--secondary-text-color);
  background: var(--tag-background-color);
  opacity: 1;
}
.set-viery-container .back {
  display: flex;
  align-items: center;
  margin-top: 90px;
  font-weight: 400;
  font-size: 16px;
  line-height: 19px;
  color: var(--accent-color);
  opacity: 1;
  cursor: pointer;
  gap: 8px;
}
.set-viery-container .back svg {
  position: relative;
  top: -1px;
  color: var(--accent-color);
}
.set-viery-container .code-error {
  position: absolute;
  left: calc((100vw - 316px) / 2);
  margin-top: 224px;
  font-weight: 400;
  font-size: 12px;
  color: var(--error-color);
}
@media (min-width: 600px) {
  .set-viery-container .code-error {
    left: calc((var(--vw) * 100 - 316px) / 2);
  }
}
.set-viery-container .send-again {
  margin-top: 20px;
  border: none !important;
  outline: none !important;
  font-weight: 400;
  font-size: 16px;
  line-height: 19px;
  color: var(--text-color);
  background-color: transparent;
  box-shadow: none;
}
.set-viery-container .send-again:hover {
  color: var(--text-color) !important;
  background-color: transparent !important;
}
.set-viery-container .send-again:disabled {
  opacity: 0.5;
}
`;var Me=R=>{let c=G(),{t:n}=Ee(),W=R,v=O(),{customRouter:X}=F(),{themeType:Y,language:Z}=I(),{account:a,pageType:d,authType:s,verifyToken:ee,redirectUrl:te,password:ne}=W,[x,oe]=b(""),[L,C]=b(1e3),[y,_]=b(60),[w,l]=b(),{authCoreModal:N}=D(),{userInfo:ie}=H(),S=Be(null);Ae(()=>{if(y>0){let e=y-1;_(e),e===0&&C(void 0)}},L);let{run:B}=h(async e=>d==="bind_login_account"?(e={[s]:a,cf_turnstile_response:e.cf_turnstile_response},ve(e).then(t=>t)):be(e.verifyCodeMethod),{manual:!0,onSuccess:(e,t)=>{L||(_(60),C(1e3))},onError:e=>{_(0),C(void 0)}}),{loading:re,runAsync:E}=h(Ce,{manual:!0,onError:e=>{(e==null?void 0:e.error_code)===m.InvalidCode?l(n("login.invalid_code")):(e==null?void 0:e.error_code)===m.ResendCode?l(n("login.please_send_again")):e.message&&v.error(e.message)}}),{loading:ae,runAsync:se}=h(async e=>he(e).then(async()=>{await J()}),{manual:!0,onSuccess:e=>{v.success(n("new.bind_login_account_success"))},onError:e=>{var i;let t=e.message;if((e==null?void 0:e.error_code)===m.InvalidCode){l(n("login.invalid_code"));return}else if((e==null?void 0:e.error_code)===m.ResendCode){l(n("login.please_send_again"));return}else e.error_code===20109?t=s==g.email?n("error.server_email_20109"):n("error.server_phone_20109"):t=((i=e==null?void 0:e.extra)==null?void 0:i[0])||e.message;ke.error({title:t,wrapClassName:"auth-core-modal-error",getContainer:()=>N.rootBody,onOk:()=>{var r;(r=S.current)==null||r.clear(),e.error_code===20109&&c(-1)}})}}),{loading:ce,run:le}=h(_e,{manual:!0,onError:e=>{(e==null?void 0:e.error_code)===m.InvalidCode?l(n("login.invalid_code")):(e==null?void 0:e.error_code)===m.ResendCode&&l(n("login.please_send_again"))},onSuccess:(e,t)=>{J();let i=["account/security","solana/sign","evm-chain/sign"],r=i.map(k=>{var u;return(u=X.history)==null?void 0:u.findIndex(p=>p.path===k)}),A=r.indexOf(Math.max(...r));c(i[A],{replace:!0,back:!0})}}),{loading:de,run:Pe}=h(()=>new Promise((e,t)=>{}),{manual:!0,onSuccess:e=>{}}),f=Se(()=>a!=null&&a.includes("@")?g.email:g.phone,[a]);Q(()=>{M()},[a]);let M=()=>{l(""),d==="bind_login_account"&&s===g.phone?xe({theme:Y,language:Z,getContainer:()=>N.rootBody}).then(e=>{B({verify_code_method:f,cf_turnstile_response:e})}).catch(()=>{v.error(n("error.server_20112")),c(-1)}):B({verifyCodeMethod:f})},ue=e=>{l(""),oe(e),e.length===6&&pe(e)},pe=Ne(Le(e=>{P(e)},1e3,{leading:!0,trailing:!1}),[]),me=e=>{le({password:ne,verifyCodeMethod:f,code:e||x})},P=(e="")=>{if(w)return;let t={code:e};d==="reset_payment_password"?me(e):d=="verify_security_account_set_security_account"?E({verifyCodeMethod:f,code:e}).then(i=>{c("/account/bind",{replace:!0,state:{accountType:s,verifyToken:i,redirectUrl:te}})}):d==="verify_security_account_bind_login_account"?E({verifyCodeMethod:f,code:e}).then(i=>{let r=j({userInfo:ie,t:n}),{id:A,value:k}=r.find(u=>u.type===s)||{};if(s===g.phone||s===g.email||k||A)c("/login-account/bind",{state:{authType:s,verifyToken:i},replace:!0});else{let u=Te.encode(JSON.stringify({verifyToken:i,purpose:"bindLoginAccount"}));we({authType:s,appState:u,prompt:"select_account"}).catch(p=>{v.error((p==null?void 0:p.message)||p)})}}):d==="bind_login_account"?(t={...t,security_account_verify_token:ee,[s]:a},se(t).then(i=>{c(-2)})):"unbind_login_account"},ge=()=>a.includes("@")?z(a):V(a);Q(()=>{var i;let e=document.getElementsByClassName("react-input-code"),t=r=>r.preventDefault();return(i=e[0])==null||i.addEventListener("contextmenu",t),()=>{var r;(r=e[0])==null||r.removeEventListener("contextmenu",t)}},[]);let ye=()=>{var t;(t=document.getElementsByClassName("input-code-item")[Math.min(x.length,5)])==null||t.focus()};return o.createElement("div",{className:"set-viery-container"},o.createElement("style",null,$),o.createElement("div",{className:"account-header"},o.createElement(T,{className:"icon-navigation-back",name:"circle_back",onClick:()=>{c(-1)}})),o.createElement("h2",{className:"set-email-title"},n("account.enter_code")),o.createElement("p",{className:"set-email-desc-2"},ge()),o.createElement("div",{onClick:ye},o.createElement(U,{containerClassName:"react-input-code",inputClassName:"input-code-item",allowedCharacters:"numeric",length:6,ref:S,placeholder:" ",onChange:ue})),w&&o.createElement("div",{className:"code-error"},w),o.createElement(K,{className:"account-submit-btn",loading:ce||re||ae||de,onClick:()=>{setTimeout(()=>{P(x)})},disabled:x.length!==6},n("common.confirm")),o.createElement(K,{className:"send-again",onClick:M,disabled:y>0},y>0?`${n("login.send_again")} (${y}s)`:n("login.send_again")),o.createElement("div",{className:"back",onClick:()=>{c(-1)}},o.createElement(T,{className:"arrow1-icon",name:"arrow1_icon"}),o.createElement("span",null,n("login.back"))),o.createElement(q,null))},Xe=Me;export{Xe as default};
