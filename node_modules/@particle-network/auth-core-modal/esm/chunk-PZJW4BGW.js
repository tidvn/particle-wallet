"use client";
import{A as H,J as R,K as M,L as de,M as $,a as L,e as ke,g as He,h as $e,j as be,k as pe,p as Ie,q as Me,y as ze,z as F}from"./chunk-ZHONLBSB.js";import{d as le,e as k,f as me}from"./chunk-L535NPP3.js";import{AuthCoreEvent as je,getSecurityAccount as _e,hasMasterPassword as Oe,hasPaymentPassword as Ke,isConnected as Je,isNeedRestoreWallet as X,particleAuth as Ye}from"@particle-network/auth-core";import{walletEntryPlugin as Qe}from"@particle-network/wallet";import{useCallback as V,useEffect as Xe,useState as At}from"react";var he,fe,ge,Ne=class{constructor(){k(this,he,{buyUrl:"https://ramp-debug.particle.network"});k(this,fe,{buyUrl:"https://ramp-staging.particle.network"});k(this,ge,{buyUrl:"https://ramp.particle.network"})}get env(){return!be()&&window.__PARTICLE_ENVIRONMENT__==="development"?le(this,he):!be()&&window.__PARTICLE_ENVIRONMENT__==="staging"?le(this,fe):le(this,ge)}};he=new WeakMap,fe=new WeakMap,ge=new WeakMap;var Pt=new Ne,De=Pt;var Z=()=>{let e=R(),{userInfo:t,modalOptions:n}=M(),[s,i]=At(X()),w=V(()=>{e("account/security")},[e]),u=V(()=>{if(Oe())throw new Error("Master password already exists.");e("account/master-password")},[e]),l=V(()=>{if(!Oe())throw new Error("Master password not exist, please set it first!");if(X())throw new Error("Wallet not restore, please restore it by master password first!");e("account/master-password/change")},[e]),P=V(()=>{if(!Oe())throw new Error("Master password not exists.");if(!X())throw new Error("Wallet has been restore.");e("account/master-password/verify")},[e]),T=V(o=>{let{windowSize:f,pathName:g,query:A,topMenuType:C}=o||{};if(!Je())throw L.notLogin();Qe.openWallet({windowSize:f||"large",pathName:g||"/",query:A,topMenuType:C}),pe("open_wallet")},[]),a=V(o=>{if(!Je())throw L.notLogin();return Qe.getWalletUrl(o)},[]),b=V(o=>{var g;let f=`${De.env.buyUrl}/?language=${n.language||"en"}&theme=${n.themeType||"light"}`;if((g=n.wallet)!=null&&g.customStyle){let{light:A,dark:C}=n.wallet.customStyle;f+=`&customStyle=${encodeURIComponent(Buffer.from(JSON.stringify({light:A,dark:C})).toString("base64"))}`}o&&Object.keys(o).forEach(A=>{let C=o[A];C&&(f+=`&${A}=${encodeURIComponent(C)}`)}),typeof window!="undefined"&&window.open(f)},[n.wallet,n.themeType,n.language]),y=V(o=>{let f=_e();if(!f.email&&!f.phone)throw new Error("Please set security account first!");if(Ke())throw new Error("Payment password already exists.");if(o&&o!==f.email&&o!==f.phone)throw new Error("Invalid security account.");e("account/set-password",{state:{account:o}})},[e]),m=V(()=>{if(!Ke())throw new Error("Payment password not exists.");e("account/change-password")},[e]),h=V(()=>{let o=_e();if(o.email&&o.phone)throw new Error("Security account already exists.");let f=!o.email&&!o.phone;o.email&&!o.phone||!o.email&&o.phone?e("/account/verify",{state:{account:o.email||o.phone,authType:o.email?"phone":"email",redirectUrl:"/account/security",pageType:"verify_security_account_set_security_account"}}):(t==null?void 0:t.email)&&!o.phone?e("account/bind",{state:{showSwitch:f,accountType:"phone",redirectUrl:"account/security"}}):o.email?e("account/bind",{state:{showSwitch:f,accountType:"phone",redirectUrl:"account/security"}}):e("account/bind",{state:{showSwitch:f,accountType:"email",redirectUrl:"account/security"}})},[e,t]),r=V(()=>{let o=_e();if(!o.email&&!o.phone)throw new Error("Please set security account first!");e("login-account")},[e]);return Xe(()=>{i(t?X():!1)},[t]),Xe(()=>{let o=()=>{i(X())};return Ye.on(je.ParticleWalletRestored,o),()=>{Ye.off(je.ParticleWalletRestored,o)}},[]),{userInfo:t,needRestoreWallet:s,openAccountAndSecurity:w,openSetMasterPassword:u,openChangeMasterPassword:l,openRestoreByMasterPassword:P,openSetPaymentPassword:y,openChangePaymentPassword:m,openSetSecurityAccount:h,openLinkLoginAccount:r,openWallet:T,buildWalletUrl:a,openBuy:b}};import{RecordType as tt}from"@particle-network/analytics";import{analyticsRecord as nt,connect as Ct,thirdpartyAuth as Et}from"@particle-network/auth-core";import xt from"base64url";import{useCallback as rt}from"react";function fn(e,t){t?localStorage.setItem(e,t):St(e)}function gn(e){return localStorage.getItem(e)}function Ze(e){let t=localStorage.getItem(e);return t||localStorage.setItem(e,"1"),Boolean(t)}function St(e){localStorage.removeItem(e)}var z=class{};z.PN_OPEN_SET_PAYMENT_PASSWORD="PN_OPEN_SET_PAYMENT_PASSWORD",z.PN_OPEN_SET_MASTER_PASSWORD="PN_OPEN_SET_MASTER_PASSWORD";var et=e=>e===2||e===3?!0:e||e===1?!Ze(z.PN_OPEN_SET_MASTER_PASSWORD):!1;var vt=()=>{let e=R(),{loginSuccessRedirectToApp:t,modalOptions:n,events:s}=M(),i=rt(async(u,l=!0)=>{var P,T;try{let a=await Ct(u);pe("login",a),nt({record_type:tt.PAGE_LOGIN_BUTTON_CLICK_SUCCESS}),(P=a.security_account)!=null&&P.has_set_master_password?e("account/master-password/verify",{replace:!0,state:{loginVerifyMasterPassword:!0}}):et((T=n.promptSettingConfig)==null?void 0:T.promptMasterPasswordSettingWhenLogin)?e("account/master-password/prompt",{replace:!0}):t()}catch(a){if(nt({record_type:tt.PAGE_LOGIN_BUTTON_CLICK_FAILURE}),l)s.emit("loginFail",a);else throw a}},[n.promptSettingConfig,e,t]),w=rt(async u=>{try{let l=xt(JSON.stringify({chain:u.chain,authorization:u.authorization,socialType:u.socialType}));await Et({authType:u.socialType,appState:l,prompt:u.prompt})}catch(l){s.emit("loginFail",l)}},[s]);return{loginHandler:i,socialAuthLogin:w}},st=vt;import{AuthCoreEvent as ye,AuthType as Ve,check as ee,disconnect as bt,getCloudflareTurnstileResponse as It,getConnectCaptcha as ot,isConnected as Mt,isNullish as it,particleAuth as we,requireNotNullish as Nt}from"@particle-network/auth-core";import{useCallback as Re,useEffect as _t,useMemo as Ot}from"react";var te=()=>{let e=R(),{events:t}=$(),{modalOptions:n,setLoginAuthorization:s,setConnectionStatus:i,connectionStatus:w,setAuthCoreModal:u,socialConnectCallback:l,setSocialConnectCallback:P}=M(),{loginHandler:T,socialAuthLogin:a}=st(),b=Re(r=>{let{email:o,phone:f,code:g,jwt:A,socialType:C}=r;return(ke(o)||He(f))&&$e(g)||C||A},[]),y=Re(async r=>{if(r&&r.authorization&&ee(r.chain,"chain is required when authorization is provided"),r&&n.authTypes&&n.authTypes.length>0)if("email"in r&&!it(r.email))ee(n.authTypes.includes(Ve.email),'Email login is not supported, please add AuthType.email to AuthCoreContextProvider init-param "authTypes"');else if("phone"in r&&!it(r.phone))ee(n.authTypes.includes(Ve.phone),'Phone login is not supported, please add AuthType.phone to AuthCoreContextProvider init-param "authTypes"');else if("socialType"in r&&r.socialType){let o=r.socialType==="twitterv1"?"twitter":r.socialType;ee(n.authTypes.includes(o),`${o} login is not supported, please add AuthType.${o} to AuthCoreContextProvider init-param "authTypes"`)}else"jwt"in r&&r.jwt&&ee(n.authTypes.includes(Ve.jwt),'JWT login is not supported, please add AuthType.jwt to AuthCoreContextProvider init-param "authTypes"');return i("connecting"),new Promise((o,f)=>{if(t.once("loginSuccess",g=>{var x;i("connected"),u({particleModalVisible:!1});let{socialType:A,nonce:C,code:I}=r||{};A&&C&&I&&((x=l==null?void 0:l.onSuccess)==null||x.call(l,g)),o(g)}),t.once("loginFail",g=>{var x;i("disconnected"),u({particleModalVisible:!1});let{socialType:A,nonce:C,code:I}=r||{};A&&C&&I&&((x=l==null?void 0:l.onError)==null||x.call(l,g)),f(g)}),r&&b(r)){let{authorization:g,chain:A,socialType:C,nonce:I,prompt:x,code:p}=r;s(g?{authorization:g,chain:Nt(A)}:void 0),C&&(!I||!p)?a({socialType:C,prompt:x,authorization:g,chain:A}):T(r)}else e("login",{state:r})})},[t,n.authTypes,T,b,e,l]);_t(()=>{let r=()=>{i("connected")},o=()=>{i("disconnected")};return we.on(ye.ParticleAuthConnect,r),we.on(ye.ParticleAuthDisconnect,o),Mt()&&i("connected"),()=>{we.off(ye.ParticleAuthConnect,r),we.off(ye.ParticleAuthDisconnect,o)}},[]);let m=Re(async r=>{if("email"in r&&r.email)return await ot(r);if("phone"in r&&r.phone){let o=await It(r.cloudflareOptions);return await ot({phone:r.phone,cf_turnstile_response:o})}throw new Error("Invalid config")},[]),h=Ot(()=>w==="connected",[w]);return{connect:y,disconnect:bt,connectionStatus:w,connected:h,requestConnectCaptcha:m,setSocialConnectCallback:P}};var Vt=()=>{let{modalOptions:e,setModalOptions:t}=M(),n=a=>{t({themeType:a})},s=a=>{t({customStyle:a?{...a}:void 0})},i=a=>{t({language:a})},w=a=>{t({authTypes:a?[...a]:void 0})},u=a=>{t({fiatCoin:a})},l=a=>{t({erc4337:a})},P=a=>{t({wallet:{...a}})},T=a=>{t({promptSettingConfig:a})};return{themeType:e.themeType,setThemeType:n,customStyle:e.customStyle,setCustomStyle:s,walletOptions:e.wallet,setWalletOptions:P,language:e.language,setLanguage:i,authTypes:e.authTypes,setAuthTypes:w,fiatCoin:e.fiatCoin,setFiatCoin:u,erc4337:e.erc4337,setERC4337:l,promptSettingConfig:e.promptSettingConfig,setPromptSettingConfig:T}};import{isHexString as Rt,stripHexPrefix as at}from"@ethereumjs/util";import{BigNumber as O}from"bignumber.js";import ne from"bn.js";import re from"ethjs-unit";import se from"numbro";function kn(e,t){return!e||!t?"0":se(e/Math.pow(10,t)).format({thousandSeparated:!0,mantissa:t,trimMantissa:!0})}function Hn(e,t="ether"){return new O(H(oe(e,t)))}function $n(e){return typeof e=="string"||typeof e=="number"?new O(e):new O(F(e))}function oe(e,t="ether"){return e?re.toWei(e,t):new ne(0)}function zn(e,t="ether"){if(!e)return"0";let n;return typeof e=="string"&&e.startsWith("0x")?n=re.fromWei(new ne(at(e),16),t):n=re.fromWei(new ne(e),t),n}function Dn(e,t="ether",n=6){if(!e)return"0";let s;return typeof e=="string"&&e.startsWith("0x")?s=re.fromWei(new ne(at(e),16),t):s=re.fromWei(new ne(e),t),se(s).format({thousandSeparated:!0,trimMantissa:!0,mantissa:n})}function jn({amount:e,price:t,mantissa:n,fiatCoin:s}){if(!t)return"";let i=new O(e).multipliedBy(new O(t));return ze(n)&&(i.lt(new O(1))?n=4:n=2),`\u2248${se(i).format({thousandSeparated:!0,trimMantissa:!0,mantissa:n}).replace(/-0$/,"0")} ${s.toUpperCase()}`}function Kn(e,t=6){return se(e).format({thousandSeparated:!0,trimMantissa:!0,mantissa:t})}function Jn(e,t=6){let s=new O(e,Rt(e)?16:10).div(new O(1e6)).toString(10);return se(s).format({thousandSeparated:!0,trimMantissa:!0,mantissa:t})}var Yn=(e,t)=>{let n;e instanceof O?n=e:n=new O(e).dividedBy(new O(10).pow(t));let s=n.toFixed(),[i,w]=s.split("."),u=9;if(i.length>15)return n.toExponential(2);if(i.length>5&&(u=Math.max(9-(i.length-5),0)),w&&u>0){let l=w.slice(0,u);return new O(`${i}.${l}`).toFixed()}return i};var ie=()=>{let{userInfo:e}=M();return{userInfo:e}};import{AuthCoreEvent as ft,AuthType as $t,EvmRpcMethod as q,SignTypedDataVersion as gt,check as Le,getLatestAuthType as zt,isConnected as Dt,particleAuth as E,requireNotNullish as Ce}from"@particle-network/auth-core";import{chains as jt}from"@particle-network/chains";import{useCallback as K,useEffect as Fe,useMemo as yt,useState as Ue}from"react";import{EvmEnhancedMethod as Ft,GasFeeMode as We,isNullish as Ut,particleAuth as ae}from"@particle-network/auth-core";import{chains as Bt}from"@particle-network/chains";import{isHexString as ct}from"@ethereumjs/util";import{tronAddressToHex as ut}from"@particle-network/auth-core";import{chains as lt}from"@particle-network/chains";import{BigNumber as Wt}from"bignumber.js";function or(e){return typeof e=="number"?e===2:typeof e=="string"?Number(e)===2:!1}var W=e=>typeof e=="string"?e.startsWith("0x")?e:`0x${new Wt(e).toString(16)}`:F(e);function mt(e,t){let n,s,i,w,u,l,P,T,a,b,y,m,h,r=Lt(t);return r&&!ct(e.from)?w=ut(e.from):w=e.from,e.to&&(r&&!ct(e.to)?u=ut(e.to):u=e.to),e.gas&&!e.gasLimit?i=W(e.gas):e.gasLimit&&(i=W(e.gasLimit)),e.value&&(l=W(e.value)),e.data&&(P=F(e.data)),e.chainId?a=W(e.chainId):a=W(t.id),e.nonce&&(n=W(e.nonce)),"maxPriorityFeePerGas"in e&&e.maxPriorityFeePerGas&&(b=W(e.maxPriorityFeePerGas)),"maxFeePerGas"in e&&e.maxFeePerGas&&(y=W(e.maxFeePerGas)),e.gasPrice&&(s=W(e.gasPrice)),e.type||e.type===0?T=W(e.type):"maxPriorityFeePerGas"in e&&e.maxPriorityFeePerGas&&"maxFeePerGas"in e&&e.maxFeePerGas&&lt.isChainSupportEIP1559(t)?T="0x2":"gasPrice"in e&&e.gasPrice?T="0x0":T=lt.isChainSupportEIP1559(t)?"0x2":"0x0",e.action&&["normal","cancel","speedup"].includes(e.action)?m=e.action:m=void 0,e.gasLevel&&["custom","low","medium","high"].includes(e.gasLevel)?h=e.gasLevel:h=void 0,{nonce:n,gasPrice:s,gasLimit:i,from:w,to:u,value:l,data:P,type:T,chainId:a,maxPriorityFeePerGas:b,maxFeePerGas:y,action:m,gasLevel:h}}function ir(e){return e&&e.length===42&&e.startsWith("0x")}function Lt(e){return e.name.toLowerCase()==="tron"}var qt=async e=>{let t=Number(e.chainId||ae.ethereum.chainId),n={...e,from:ae.ethereum.selectedAddress,chainId:t},s=Bt.getEVMChainInfoById(t);Ut(n.data)&&(n.data="0x");let i=mt(n,s);if(i.gasLimit||(i.gasLimit=await Gt({from:i.from,to:i.to,value:i.value,data:i.data},t)),Number(i.type)===2){if(!i.maxPriorityFeePerGas||!i.maxFeePerGas){let u=await pt(t);i.maxFeePerGas=H(oe(u[We.medium].maxFeePerGas,"gwei")),i.maxPriorityFeePerGas=H(oe(u[We.medium].maxPriorityFeePerGas,"gwei"))}}else if(!i.gasPrice){let u=await pt(t);i.gasPrice=H(oe(u[We.medium].maxFeePerGas,"gwei"))}return await ae.ethereum.sendTransaction(i)},Gt=async(e,t)=>((!e.to||e.to.length===0)&&delete e.to,await ae.ethereum.request({chainId:t,method:"eth_estimateGas",params:[e]})),pt=async e=>await ae.ethereum.request({chainId:e,method:Ft.suggestedGasFees}),dt=qt;import{addHexPrefix as kt,isHexString as Ht}from"@ethereumjs/util";import{providerErrors as ce,rpcErrors as D}from"@metamask/rpc-errors";import{EvmRpcMethod as U,ethereumUtils as Te,isNullish as Pe,requireNotNullish as B}from"@particle-network/auth-core";import{chains as ht}from"@particle-network/chains";var j,Ae,Se=class{constructor(){k(this,j);this.signMessage=async(t,n)=>{throw new Error("signMessage not implemented.")};this.sendTransaction=async t=>{throw new Error("sendTransaction not implemented.")};this.signTypedData=async({data:t,version:n,uniq:s})=>{throw new Error("signTypedData not implemented.")}}get selectedAddress(){return B(window.particleAuth).ethereum.selectedAddress}get chainId(){return B(window.particleAuth).ethereum.chainId}isConnected(){return B(window.particleAuth).ethereum.isConnected()}on(t,n){var s;return(s=window.particleAuth)==null||s.ethereum.on(t,n),this}once(t,n){var s;return(s=window.particleAuth)==null||s.ethereum.once(t,n),this}off(t,n){var s;return(s=window.particleAuth)==null||s.ethereum.off(t,n),this}removeListener(t,n){var s;return(s=window.particleAuth)==null||s.ethereum.removeListener(t,n),this}async enable(){return await B(window.particleAuth).ethereum.enable()}async disconnect(){return await B(window.particleAuth).ethereum.disconnect()}async request(t){var s,i,w,u,l,P,T,a,b;let n=t.method;if(!n)throw D.invalidParams("Invalid parameters: method is required.");if(Object.values(U).includes(n)){if(n===U.ethAccounts||n===U.ethRequestAccounts)return await B(window.particleAuth).ethereum.request(t);if(n===U.ethChainId)return this.chainId;if(n.startsWith(U.ethSignTypedData)){me(this,j,Ae).call(this);let y=Te.isSignTypedDataV1(n),m=y?(s=t==null?void 0:t.params)==null?void 0:s[1]:(i=t==null?void 0:t.params)==null?void 0:i[0],h=y?(w=t==null?void 0:t.params)==null?void 0:w[0]:(u=t==null?void 0:t.params)==null?void 0:u[1];if(!m||typeof m!="string")throw D.invalidParams("Invalid parameters: must provide an Ethereum address.");if(!h)throw D.invalidParams("Invalid parameters: must provide typed data.");if(m.toLowerCase()!==((l=this.selectedAddress)==null?void 0:l.toLowerCase()))throw ce.unauthorized();typeof h=="string"&&(h=JSON.parse(h));let r=Te.isUniq(n),o=Te.getSignTypedVersion(n);return await this.signTypedData({data:h,version:o,uniq:r})}else if(n.startsWith(U.personalSign)){me(this,j,Ae).call(this);let y=(P=t==null?void 0:t.params)==null?void 0:P[0],m=(T=t==null?void 0:t.params)==null?void 0:T[1];if(!y||typeof y!="string")throw D.invalidParams("Invalid parameters: must provide a valid message.");if(!m||typeof m!="string")throw D.invalidParams("Invalid parameters: must provide an Ethereum address.");if(m.toLowerCase()!==((a=this.selectedAddress)==null?void 0:a.toLowerCase()))throw ce.unauthorized();Ht(y)||(y=kt(Buffer.from(y).toString("hex")));let h=Te.isUniq(n);return await this.signMessage(y,h)}else{if(n===U.walletSwitchEthereumChain)return await B(window.particleAuth).ethereum.request(t);if(n===U.ethSendTransaction){me(this,j,Ae).call(this);let y=Number(t.chainId||this.chainId),m=ht.getEVMChainInfoById(y);if(!m)throw ce.chainDisconnected();let h=(b=t.params)==null?void 0:b[0];if(!h)throw D.invalidParams("Invalid parameters: must provide an transaction data.");return Pe(h.type)&&(ht.isChainSupportEIP1559(m)?h.type="0x2":h.type="0x0"),Pe(h.chainId)&&(h.chainId=`0x${y.toString(16)}`),Pe(h.nonce)&&(h.nonce="0x0"),Pe(h.data)&&(h.data="0x"),await this.sendTransaction(h)}else throw ce.unsupportedMethod()}}else return await B(window.particleAuth).ethereum.request(t)}};j=new WeakSet,Ae=function(){if(!this.isConnected())throw ce.unauthorized()};var Kt=()=>{var x;let e=R(),{events:t}=$(),[n,s]=Ue(Number(E.ethereum.chainId)),[i,w]=Ue(Ce(Ie(n))),[u,l]=Ue(E.ethereum.selectedAddress),{userInfo:P}=ie(),{needRestoreWallet:T}=Z(),{modalOptions:a}=de(),{setAuthCoreModal:b}=M(),{connect:y}=te(),m=yt(()=>{var p;return!(T||(P==null?void 0:P.security_account.has_set_payment_password)||((p=a.promptSettingConfig)==null?void 0:p.promptPaymentPasswordSettingWhenSign)||zt()!==$t.jwt)},[P==null?void 0:P.security_account.has_set_payment_password,T,(x=a.promptSettingConfig)==null?void 0:x.promptPaymentPasswordSettingWhenSign]);Fe(()=>{let p=N=>{s(Number(N))};E.ethereum.on("chainChanged",p);let c=()=>{l(E.ethereum.selectedAddress)};E.ethereum.on("connect",c);let d=N=>{N[0]&&l(N[0])};E.ethereum.on("accountsChanged",d);let v=()=>{l(null)};E.ethereum.on("disconnect",v);let _=({resolve:N,reject:Y})=>{y().then(Q=>{N(Q)}).catch(Q=>{Y(Q)})};return E.on(ft.RequestEthereumAccount,_),()=>{E.ethereum.off("chainChanged",p),E.ethereum.off("connect",c),E.ethereum.off("accountsChanged",d),E.ethereum.off("disconnect",v),E.off(ft.RequestEthereumAccount,_)}},[y]),Fe(()=>{n&&w(Ce(Ie(n)))},[n]);let h=()=>{Le(E,"Please init first!"),Le(Dt(),L.notLogin()),Le(E.ethereum.selectedAddress,"Please create wallet first!")},r=K(async p=>(h(),await new Promise((d,v)=>{t.listenerCount("signResponse")>0?v(L.pending("sign")):(t.once("signResponse",_=>{_.error?v(_.error):d(_.result),b({particleModalVisible:!1})}),e("evm-chain/sign",{replace:!0,state:p}))})),[e,t]),o=K(async(p,c)=>m?await E.ethereum.signMessage(F(p),c):await r({param:F(p),method:c?q.personalSignUniq:q.personalSign}),[r,m]),f=K(async({data:p,version:c,uniq:d})=>m?await E.ethereum.signTypedData({data:p,version:c,uniq:d}):await r({param:p,method:Jt({version:c,uniq:d})}),[r,m]),g=K(async p=>{if(p.chainId&&!jt.getEVMChainInfoById(Number(p.chainId)))throw new Error(`The chainId: ${p.chainId} is not supported.`);return m?await dt(p):await r({param:{...p,from:u,chainId:p.chainId||n},method:q.ethSendTransaction})},[u,n,r,m]),A=K(async p=>{await Ce(E,"Please init first!").ethereum.switchChain(p)},[]),C=K(async()=>(await Ce(E,"Please init first!").ethereum.enable())[0],[]),I=yt(()=>{let p=new Se;return p.signMessage=o,p.signTypedData=f,p.sendTransaction=g,p},[]);return Fe(()=>{I&&(I.signMessage=o,I.signTypedData=f,I.sendTransaction=g)},[I,o,f,g]),{provider:I,address:u,chainId:n,chainInfo:i,switchChain:A,signMessage:o,signTypedData:f,sendTransaction:g,enable:C}};function Jt({version:e,uniq:t}){return gt.V1===e?q.ethSignTypedDataV1:gt.V3===e?q.ethSignTypedDataV3:t?q.ethSignTypedDataV4Uniq:q.ethSignTypedDataV4}import{useEffect as Yt,useReducer as Qt}from"react";var Xt=()=>{let[e,t]=Qt(()=>!0,!1);return Yt(t,[t]),e};import{AuthCoreEvent as wt,AuthType as Zt,SolanaRpcMethod as xe,check as J,getLatestAuthType as en,isConnected as tn,particleAuth as S,requireNotNullish as ue}from"@particle-network/auth-core";import{chains as Be}from"@particle-network/chains";import{useCallback as G,useEffect as qe,useMemo as Tt,useState as Ge}from"react";var Ee=class{constructor(){this.isParticleNetwork=!0;this.name="Particle";this.url="https://particle.network";this.icon="https://static.particle.network/wallet-icons/Particle.png";this.signTransaction=async(t,n)=>{throw new Error("signMessage not implemented.")};this.signAllTransactions=async(t,n)=>{throw new Error("signMessage not implemented.")};this.signAndSendTransaction=async(t,n)=>{throw new Error("signMessage not implemented.")};this.signMessage=async t=>{throw new Error("signMessage not implemented.")};this.switchChain=async t=>{var n;await((n=window.particleAuth)==null?void 0:n.solana.switchChain(t))}}on(t,n){var s;return(s=window.particleAuth)==null||s.solana.on(t,n),this}once(t,n){var s;return(s=window.particleAuth)==null||s.solana.once(t,n),this}off(t,n){var s;return(s=window.particleAuth)==null||s.solana.off(t,n),this}removeListener(t,n){var s;return(s=window.particleAuth)==null||s.solana.removeListener(t,n),this}get connecting(){var t,n;return(n=(t=window.particleAuth)==null?void 0:t.solana.connecting)!=null?n:!1}get connected(){var t,n;return(n=(t=window.particleAuth)==null?void 0:t.solana.connected)!=null?n:!1}async publicKey(){var t;return(t=window.particleAuth)==null?void 0:t.solana.publicKey()}get selectedAddress(){var t,n;return(n=(t=window.particleAuth)==null?void 0:t.solana.selectedAddress)!=null?n:null}get chainId(){var t,n;return(n=(t=window.particleAuth)==null?void 0:t.solana.chainId)!=null?n:101}async connect(){var t;await((t=window.particleAuth)==null?void 0:t.solana.connect())}async disconnect(){var t;await((t=window.particleAuth)==null?void 0:t.solana.disconnect())}async request(t){var n;return(n=window.particleAuth)==null?void 0:n.solana.request(t)}};var nn=()=>{var p;let e=R(),{events:t}=$(),[n,s]=Ge(S.solana.chainId),[i,w]=Ge(ue(Me(S.solana.chainId))),[u,l]=Ge(S.solana.selectedAddress),{setAuthCoreModal:P}=M(),{connect:T}=te(),{userInfo:a}=ie(),{needRestoreWallet:b}=Z(),{modalOptions:y}=de(),m=Tt(()=>{var c;return!(b||(a==null?void 0:a.security_account.has_set_payment_password)||((c=y.promptSettingConfig)==null?void 0:c.promptPaymentPasswordSettingWhenSign)||en()!==Zt.jwt)},[a==null?void 0:a.security_account.has_set_payment_password,b,(p=y.promptSettingConfig)==null?void 0:p.promptPaymentPasswordSettingWhenSign]);qe(()=>{var N;let c=Y=>{s(Y)};S.solana.on("chainChanged",c);let d=()=>{l(S.solana.selectedAddress)};S.solana.on("connect",d),s((N=S.solana.chainId)!=null?N:101);let v=()=>{l(null)};S.solana.on("disconnect",v);let _=({resolve:Y,reject:Q})=>{T().then(ve=>{Y(ve)}).catch(ve=>{Q(ve)})};return S.on(wt.RequestSolanaAccount,_),()=>{S.solana.off("chainChanged",c),S.solana.off("connect",d),S.solana.off("disconnect",v),S.off(wt.RequestSolanaAccount,_)}},[T]),qe(()=>{n&&w(ue(Me(n)))},[n]);let h=()=>{J(S,"Please init first!"),J(tn(),L.notLogin()),J(S.solana.selectedAddress,"Please create wallet first!")},r=G(async c=>(h(),await new Promise((v,_)=>{t.listenerCount("signResponse")>0?_(L.pending("sign")):(t.once("signResponse",N=>{N.error?_(N.error):v(N.result),P({particleModalVisible:!1})}),e("solana/sign",{replace:!0,state:c}))})),[e]),o=G(async c=>m?await S.solana.signMessage(c):await r({param:c,method:xe.signMessage}),[r,m]),f=G(async(c,d)=>(J(!d||Be.getSolanaChainInfoById(d),`The chainId: ${d} is not supported`),m?await S.solana.signTransaction(c,d):await r({param:c,method:xe.signTransaction,chainId:d})),[r,m]),g=G(async(c,d)=>(J(!d||Be.getSolanaChainInfoById(d),`The chainId: ${d} is not supported`),m?await S.solana.signAllTransactions(c,d):await r({param:c,method:xe.signAllTransactions,chainId:d})),[r,m]),A=G(async(c,d)=>(J(!d||Be.getSolanaChainInfoById(d),`The chainId: ${d} is not supported`),m?await S.solana.signAndSendTransaction(c,d):await r({param:c,method:xe.signAndSendTransaction,chainId:d})),[r,m]),C=G(async c=>{await ue(S,"Please init first!").solana.switchChain(c)},[]),I=G(async()=>(await ue(S,"Please init first!").solana.connect(),ue(S.solana.selectedAddress)),[]),x=Tt(()=>{let c=new Ee;return c.signMessage=o,c.signTransaction=f,c.signAllTransactions=g,c.signAndSendTransaction=A,c},[]);return qe(()=>{x&&(x.signMessage=o,x.signTransaction=f,x.signAllTransactions=g,x.signAndSendTransaction=A)},[x,o,f,g,A]),{address:u,chainId:n,chainInfo:i,switchChain:C,signMessage:o,signTransaction:f,signAllTransactions:g,signAndSendTransaction:A,enable:I,wallet:x}};export{Z as a,fn as b,gn as c,z as d,st as e,te as f,Vt as g,kn as h,Hn as i,$n as j,oe as k,zn as l,Dn as m,jn as n,Kn as o,Jn as p,Yn as q,or as r,mt as s,ir as t,Lt as u,ie as v,Kt as w,Xt as x,nn as y};
