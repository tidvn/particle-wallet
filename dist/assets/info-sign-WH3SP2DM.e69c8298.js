import{a0 as te,a1 as re,cr as le,bP as ie,aj as oe,a2 as m,d5 as i,bS as C,bT as F,ce,d6 as l,ct as G,Q as S,d7 as me,bX as de,a3 as a,cz as ue,ai as z,cx as ge,cB as k,cC as b,d8 as P,_ as q}from"./index.fbf0f355.js";import{V as pe,L as ve,n as fe,l as Ee,D as he,T as ye}from"./index.8afc9d92.js";import{C as _e}from"./chunk-YWGBV3CL.8a54f7e0.js";import{x as Ne}from"./chunk-4SMRMVPX.9956fd00.js";import{N as we}from"./chunk-AMOVWUCP.62a50458.js";import{u as Te}from"./useTranslation.88a96d8a.js";import"./colors.5dd5d985.js";import"./chunk-QNAXMJIS.3ce008d2.js";import"./index.eac9e03e.js";var Ae="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",Ce={async findAssociatedTokenAddress(y,r){let{TOKEN_PROGRAM_ID:o}=await q(()=>import("./index.a95e0515.js"),["assets/index.a95e0515.js","assets/index.browser.esm.8c7b5242.js","assets/index.fbf0f355.js","assets/index.30c5a70a.css"]),{PublicKey:g}=await q(()=>import("./index.browser.esm.8c7b5242.js").then(t=>t.i),["assets/index.browser.esm.8c7b5242.js","assets/index.fbf0f355.js","assets/index.30c5a70a.css"]);return g.findProgramAddressSync([new g(y).toBuffer(),o.toBuffer(),new g(r).toBuffer()],new g(Ae))[0]}},D=Ce;function Se(y){let{method:r,param:o,chainId:g}=y,{t}=Te(),_=te(),{setPaymentVerify:K,userInfo:v,setPaymentPassword:V}=re(),{events:$}=le(),{modalOptions:I}=ie(),{authCoreModal:W}=oe(),{errorHandle:Z}=_e(),[x,N]=m.exports.useState(!1),M=Ne(),[d,j]=m.exports.useState(),[O,H]=m.exports.useState(),[R,X]=m.exports.useState(),[J,f]=m.exports.useState(""),[Q,E]=m.exports.useState(""),{hasSetPaymentPassword:w,showSetPaymentPasswordOrConfirm:Y}=pe(),u=m.exports.useMemo(()=>({id:g||i.solana.chainId,name:"Solana"}),[]),ee=m.exports.useMemo(()=>{let s=i.solana.selectedAddress;return C(s)},[]);m.exports.useEffect(()=>{F().catch(s=>{}),ce()&&_("account/master-password/verify")},[_]);let ae=()=>{F().then(()=>{U()}).catch(s=>{var e;N(!1),M.error((e=s.message)!=null?e:"Sign Error")})},L=(s,e)=>{$.emit("signResponse",{result:s,error:e})};async function B(s,e){if(!e)return[];let n=await Promise.all(e.map(s));return e.filter((p,c)=>n[c])}let U=async()=>{var s,e;!r||(k({record_type:b.PAGE_SIGN_CONFIRM_BUTTON_CLICK}),(s=v?.security_account)!=null&&s.has_set_payment_password?K({visible:!0,onVerifyCompleted:T}):r===l.signAndSendTransaction||r===l.signTransaction||r===l.signAllTransactions||((e=I?.promptSettingConfig)==null?void 0:e.promptPaymentPasswordSettingWhenSign)===3?Y(T):T())},T=async()=>{var s;if(!r)return;N(!0);let e;try{if(r===l.signMessage)e=await i.solana.signMessage(o);else if(r===l.signAndSendTransaction)e=await i.solana.signAndSendTransaction(o,u.id);else if(r===l.signTransaction)e=await i.solana.signTransaction(o,u.id);else if(r===l.signAllTransactions)e=await i.solana.signAllTransactions(o,u.id);else throw new Error("Unknown method");k({record_type:b.PAGE_SIGN_CONFIRM_BUTTON_CLICK_SUCCESS})}catch(n){k({record_type:b.PAGE_SIGN_CONFIRM_BUTTON_CLICK_FAILURE}),n?.error_code===50103&&!((s=v?.security_account)!=null&&s.has_set_payment_password)?ae():n?.message==="Local Key not found"||n?.message==="Master password decryption error"?_("account/master-password/verify"):Z(n)}finally{N(!1)}e&&L(e)};m.exports.useEffect(()=>{if(r===l.signMessage)f(t("sign.signature_message")),E(t("sign.signature_title"));else if(r===l.signAndSendTransaction){f(t("sign.send_transaction")),E(t("sign.approve_and").format(G(u)));let s=o.serialize({requireAllSignatures:!1,verifySignatures:!1});h([S.encode(s)])}else if(r===l.signTransaction){f(t("sign.sign_transaction")),E(t("sign.sign_but"));let s=o.serialize({requireAllSignatures:!1,verifySignatures:!1});h([S.encode(s)])}else if(r===l.signAllTransactions){f(t("sign.sign_transaction")),E(t("sign.sign_but"));let s=o.map(e=>S.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1})));h(s)}else throw new Error("Unknown method")},[o]),m.exports.useEffect(()=>{i.solana.connect()},[]);let h=s=>{i.solana.request({chainId:u.id,method:me.enhancedDeserializeTransaction,params:s}).then(e=>{var n,p;j(e),B(async c=>{let A=await D.findAssociatedTokenAddress(i.solana.selectedAddress,c.mint);return c.associatedTokenAddress===A.toBase58()},(n=e?.estimatedChanges)==null?void 0:n.nfts).then(c=>{H(c)}),B(async c=>{let A=await D.findAssociatedTokenAddress(i.solana.selectedAddress,c.mint);return c.associatedTokenAddress===A.toBase58()},(p=e?.estimatedChanges)==null?void 0:p.tokens).then(c=>{X(c)})}).catch(e=>{var n;de.error({title:(n=e.message)!=null?n:"Deserialize Transaction Error",okCancel:!0,cancelText:t("common.cancel"),okText:t("common.retry"),wrapClassName:"auth-core-modal-error",getContainer:()=>W.rootBody,onOk:()=>{h(s)}})})},se=()=>{let s=new TextDecoder().decode(o);return a.createElement("div",{className:"sign-message"},a.createElement("div",{className:"message"+(w?"":" no-password-tip")},a.createElement("div",{className:"pre-wrap personal-message"},s)))},ne=()=>{var s;return a.createElement(ye,{defaultActiveKey:"1",items:[{label:t("sign.details"),key:"1",children:a.createElement(a.Fragment,null,a.createElement("div",{className:"balance-change"},a.createElement("div",{className:"title"},t("sign.estimated_balance_change")),a.createElement("div",{className:"change-body"},(s=d?.estimatedChanges)==null?void 0:s.sols.filter(e=>{var n,p;return e.address===((p=(n=i)==null?void 0:n.solana)==null?void 0:p.selectedAddress)}).map((e,n)=>a.createElement("div",{className:"change-title",key:`sol-change-${n}`},"SOL",a.createElement("div",{className:"change-val",style:e.lamportsChange<0?{color:"#ea4335"}:{}},e.lamportsChange<0?"":"+",P(e.lamportsChange,9)))),O?.map((e,n)=>a.createElement("div",{className:"change-title",key:`nft-change-${n}`},e.name?e.name:"Unknown NFT",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",e.amountChange))),R?.map((e,n)=>a.createElement("div",{className:"change-title",key:`token-change-${n}`},e.name?e.name:"Unknown Token",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",P(e.amountChange,e.decimals)))))),a.createElement("div",{className:"net-fee solana"},a.createElement("div",{className:"title"},t("sign.network_fee"),d&&a.createElement("div",{className:"fee-val"},P(d.estimatedLamportsFee,9)," SOL"))))},{label:t("sign.data"),key:"2",children:a.createElement("div",null,d?.instructions.map((e,n)=>a.createElement("div",{className:"inner-instruction",key:`instruction-${n}`},a.createElement("div",{className:"inner-content"},a.createElement("div",{className:"content-item"},a.createElement("div",{className:"item"},a.createElement("div",{className:"item-0"},"#",n+1," - ",t(`program.${e.type}`)),a.createElement("div",{className:"item-1 mt10"},t("sign.program_id"),a.createElement("span",null,C(e.programId))),a.createElement("div",{className:"item-1 mt15"},t("sign.data"),a.createElement("span",null,C(e.data)))))))))}]})};return a.createElement("div",{className:"info-sign"},a.createElement("style",null,ve),!w&&a.createElement("div",{className:"has-payment-password"},a.createElement("div",{className:"has-payment-password-icon"}),a.createElement("div",{className:"has-payment-password-tip"},t("account.waring_tip1")),a.createElement("div",{className:"has-payment-password-set",onClick:V},t("account.set"))),a.createElement("div",{className:"scroll-part"+(w?"":" no-password-tip")},a.createElement(fe,{userInfo:v,transactionInfo:d}),a.createElement("div",{className:"info-request"},J),a.createElement("div",{className:"info-title"},a.createElement("img",{src:ue(u),alt:""}),G(u)),a.createElement(Ee,{text:i.solana.selectedAddress,onCopy:()=>M.success(t("new.copied_to"))},a.createElement("div",{className:"info-address"},ee,a.createElement("div",{className:"copy-icon"},a.createElement(he,null)))),a.createElement("div",{className:"info-des"},Q),a.createElement("div",{className:"apart-line"}),r===l.signMessage&&se(),r!==l.signMessage&&ne()),a.createElement("div",{className:"btn-box"},a.createElement("div",null,a.createElement(z,{className:"btn-cancel",onClick:()=>{x||L(void 0,ge.userRejectedRequest())}},t("common.cancel")),a.createElement(z,{className:"btn-approve",onClick:U,loading:x},t("common.confirm"))),a.createElement(we,null)))}var Be=Se;export{Be as default};
